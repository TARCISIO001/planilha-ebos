<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Lista de Eb√≥</title>
  <link rel="stylesheet" href="./style.css.css">
</head>

<body>

<!-- =========================
     TELA 1: LOGIN
========================= -->
<section class="login-card" id="authCard">
  <h3>Bem-vindo</h3>
  <p class="hint" style="text-align:center; margin-top:6px;">Fa√ßa seu login.</p>

  <div class="auth-grid">
    <div>
      <label class="label">Usu√°rio</label>
      <input id="authUser" type="text" placeholder="usu√°rio" autocomplete="username" />
      <div class="hint">Voc√™ entra com usu√°rio.</div>
    </div>

    <div>
      <label class="label">Senha</label>
      <input id="authSenha" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
    </div>

    <div class="auth-actions">
      <button class="btn-secondary" id="btnEntrar">Entrar</button>
    </div>
  </div>

  <div class="hint" id="authMsg"></div>
</section>

<!-- =========================
     APP PRINCIPAL
========================= -->
<div class="app-container">
<div id="postLogin" style="display:none;">

  <!-- TOPO -->
  <section class="card">
    <div class="section-head">

      <div class="actions-row" style="margin:0;">
        <button class="btn-secondary" onclick="abrirTelaAdmin()" id="btnAdmin">√Årea Administrativa</button>
        <button class="btn-tertiary" onclick="abrirTelaOferendas()" id="btnOferendas">Oferendas</button>
      </div>

      <div class="saved-title">Painel</div>

      <div class="actions-row" style="margin:0;">
        <div class="firebase-pill" id="firebaseStatus">Firebase: n√£o conectado</div>
        <button class="btn-danger" onclick="sair()" id="btnSair">Sair</button>
      </div>

    </div>
  </section>

  <!-- GERAR LISTA -->
  <section class="card">
    <h2>Gerar lista de eb√≥</h2>

    <label class="label">Nome do eb√≥</label>
    <input id="eboNome" type="text" placeholder="Ex: Eb√≥ Exu" oninput="autoCarregarListaDebounced()" />

    <label class="label" style="margin-top:12px;">Quantidade de Pessoas</label>
    <input id="numPratos" type="number" min="1" value="1" />

    <div class="actions-row">
      <button class="btn-secondary" onclick="adicionarListaAcumulada()">Adicionar lista</button>
      <button class="btn-tertiary" onclick="gerarListaFinalAcumulada()">Gerar Lista</button>
      <button class="btn-print" onclick="imprimirListaGerada()">Imprimir</button>
    </div>

    <div class="hint">
      A lista ser√° calculada multiplicando as quantidades cadastradas pela quantidade de pratos.
    </div>
  </section>

  <!-- LISTAS ADICIONADAS -->
  <section class="card">
    <div class="section-head">
      <h2>Listas adicionadas</h2>
      <button class="btn-danger btn-mini" onclick="limparListasAcumuladas()">Limpar tudo</button>
    </div>

    <div class="hint">Aqui aparecem as listas que voc√™ adicionou.</div>
    <div id="listasContainer"></div>
  </section>

  <!-- GERENCIAR LISTAS -->
  <section class="card">
    <div class="section-head">
      <h2>Gerenciar listas</h2>
    </div>

    <div class="actions-row">
      <button class="btn-secondary" onclick="cadastrarLista()">Cadastrar lista</button>
      <input id="pesquisaListas" type="text" placeholder="Procurar lista pelo nome..." style="max-width:320px;" />
      <button class="btn-tertiary" onclick="procurarListas()">Procurar</button>
    </div>

    <div id="listasSalvasBox" class="saved-list"></div>
  </section>

</div>
</div>

  <!-- =========================
       IMPRESS√ÉO
  ========================= -->
<section id="saidaPrint" class="print-area" style="display:none;">

  <!-- ‚úÖ fica fora do THEAD, ent√£o aparece s√≥ 1 vez -->
  <div class="print-header print-only-first">
    <img src="imagem.png" alt="Il√™ D‚ÄôOgum" class="print-logo">
    <h1 id="printEboNome"></h1>
  </div>

  <table class="print-table">
    <thead>
      <tr>
        <th class="print-total">Total</th>
        <th class="print-ing">Ingrediente</th>
        <th class="print-pratos">Pratos</th>
      </tr>
    </thead>
    <tbody id="printIngredientes"></tbody>
  </table>

</section>



</div>
</div>
<!-- =========================
     ADMIN
========================= -->
<section id="adminScreen" style="display:none;">
  <div class="app-container">

    <div class="section-head">
      <h2>√Årea Administrativa</h2>
      <button class="btn-tertiary" onclick="voltarTelaPrincipal()">Voltar</button>
    </div>

    <div class="admin-grid-wrapper">

      <section class="card" id="adminPanel" style="display:none;">
        <h3>Admin (Master)</h3>
        <label class="label">Novo usu√°rio</label>
        <input id="newUser" type="text">
        <label class="label">Senha inicial</label>
        <input id="newPass" type="password">

        <div class="actions-row">
          <button class="btn-secondary" onclick="cadastrarMaster()">Cadastrar Master</button>
          <button class="btn-tertiary" onclick="cadastrarCliente()">Cadastrar Cliente</button>
        </div>
      </section>

      <section class="card">
        <h3>Contas</h3>
        <button class="btn-secondary" onclick="listarContas()">Atualizar lista</button>
        <div id="accountsBox" class="saved-list"></div>
      </section>

      <section class="card">
        <h3>Gerenciar usu√°rio</h3>
        <label class="label">Usu√°rio</label>
        <input id="manageUser" type="text">
        <label class="label">Novo usu√°rio</label>
        <input id="manageNewUser" type="text">
        <label class="label">Nova senha</label>
        <input id="manageNewPass" type="password">

        <div class="actions-row">
          <button class="btn-secondary" onclick="adminRenomearLogin()">Renomear</button>
          <button class="btn-tertiary" onclick="adminTrocarSenha()">Trocar senha</button>
          <button class="btn-danger" onclick="adminBloquearUsuario()">Bloquear</button>
        </div>
      </section>

    </div>
  </div>
</section>

<!-- =========================
     OFERENDAS
========================= -->
<section id="oferendasScreen" style="display:none; min-height:100vh;">
  <div class="app-container" style="min-height:100vh; display:flex; flex-direction:column;">
    <div class="section-head">
      <h2>Projeto Oferendas</h2>
      <button class="btn-tertiary" onclick="voltarTelaPrincipal()">Voltar</button>
    </div>

    <section class="card" style="flex:1; display:flex; align-items:center; justify-content:center; text-align:center;">
      <div>
        <h1>P√°gina em constru√ß√£o</h1>
        <p class="hint">Estamos preparando algo especial.</p>
      </div>
    </section>
  </div>
</section>

<!-- =========================
     MODAL
========================= -->
<div id="modalBackdrop" class="modal-backdrop" style="display:none;">
  <div class="modal-card">

    <div class="section-head">
      <h3 style="margin:0;" id="modalTitulo">Cadastrar lista</h3>
      <button class="btn-danger btn-mini" onclick="fecharModal()">X</button>
    </div>

    <!-- ====== BLOCO 1 ====== -->
    <div style="margin-top:10px; padding:12px; border:1px solid #eee; border-radius:12px;">
      <div class="saved-title" style="margin-bottom:10px;">Lista 1</div>

      <label class="label">Nome do eb√≥</label>
<input
  id="modalNomeEbo_1"
  type="text"
  placeholder="Ex: Eb√≥ Exu"
/>

<label class="label" style="margin-top:8px;">Subt√≠tulo</label>
<input
  id="modalSubtitulo_1"
  type="text"
  placeholder="Ex: Para abertura de caminhos"
/>


      <div class="section-head" style="margin:12px 0 8px;">
        <div class="saved-title">Ingredientes</div>
        <button class="btn-tertiary btn-mini" onclick="modalAdicionarLinha('1')">
          + Adicionar linha
        </button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Ingrediente</th>
            <th style="width:160px;">Quantidade</th>
            <th style="width:120px;">A√ß√£o</th>
          </tr>
        </thead>
        <tbody id="modalBodyLinhas_1"></tbody>
      </table>
    </div>

    <!-- ====== BLOCO 2 ====== -->
    <div style="margin-top:12px; padding:12px; border:1px solid #eee; border-radius:12px;">
      <div class="saved-title" style="margin-bottom:8px;">Modo de fazer</div>
      <textarea
        id="modalModoFazer_1"
        placeholder="Escreva aqui o modo de fazer..."
        style="width:100%; min-height:120px;"
      ></textarea>
    </div>

    <!-- ====== BLOCO 3 ====== -->
    <div style="margin-top:12px; padding:12px; border:1px solid #eee; border-radius:12px;">
      <div class="saved-title" style="margin-bottom:10px;">Lista 2</div>
        <label class="label" style="margin-top:8px;">Subt√≠tulo</label>
<input
  id="modalSubtitulo_2"
  type="text"
  placeholder="Ex: Complemento / segunda parte"
/>

      <div class="section-head" style="margin:12px 0 8px;">
        <div class="saved-title">Ingredientes</div>
        <button class="btn-tertiary btn-mini" onclick="modalAdicionarLinha('2')">
          + Adicionar linha
        </button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Ingrediente</th>
            <th style="width:160px;">Quantidade</th>
            <th style="width:120px;">A√ß√£o</th>
          </tr>
        </thead>
        <tbody id="modalBodyLinhas_2"></tbody>
      </table>
    </div>

    <!-- ====== BLOCO 4 ====== -->
    <div style="margin-top:12px; padding:12px; border:1px solid #eee; border-radius:12px;">
      <div class="saved-title" style="margin-bottom:8px;">Modo de preparo</div>
      <textarea
        id="modalModoFazer_2"
        placeholder="Escreva aqui o modo de preparo..."
        style="width:100%; min-height:120px;"
      ></textarea>
    </div>

    <div class="actions-row" style="margin-top:12px;">
      <button class="btn-secondary" onclick="enviarParaBanco()">
        Enviar para banco de dados
      </button>
      <button onclick="fecharModal()">Cancelar</button>
    </div>

    <div class="hint" id="modalMsg" style="margin-top:8px;"></div>

  </div>
</div>


<!-- FIREBASE -->
<script type="module">
  const firebaseConfig = {
    apiKey: "AIzaSyByEkOQbZT0hN1yPG9PfM7uqKJ7JuzXoSs",
    authDomain: "ebos-oferendas.firebaseapp.com",
    projectId: "ebos-oferendas",
    storageBucket: "ebos-oferendas.firebasestorage.app",
    messagingSenderId: "534673187125",
    appId: "1:534673187125:web:55dd61b0e44eab893e2c7c"
  };

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";

  import {
    getFirestore,
    collection, addDoc, doc, getDoc, getDocs,
    setDoc, deleteDoc,
    query, orderBy, limit, startAt, endAt,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  import {
    getAuth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // üî• ISSO √â O QUE O java.js ESPERA
  window.__FIREBASE__ = {
    db,
    collection, addDoc, doc, getDoc, getDocs,
    setDoc, deleteDoc,
    query, orderBy, limit, startAt, endAt,
    serverTimestamp,

    auth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    signOut
  };
</script>


<script src="./java.js" defer></script>

</body>
</html>
