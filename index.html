<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>Lista de Ebó</title>
  <link rel="stylesheet" href="style.css.css">
</head>

<body>

<!-- =========================
     TELA 1: LOGIN
========================= -->
<section class="login-card" id="authCard">

  <h3>Bem-vindo</h3>
  <p class="hint" style="text-align:center; margin-top:6px;">
    Faça seu login.
  </p>

  <div class="auth-grid">
    <div>
      <label class="label">Usuário</label>
      <input id="authUser" type="text" placeholder="usuário" autocomplete="username" />
      <div class="hint">Você entra com usuário .</div>
    </div>

    <div>
      <label class="label">Senha</label>
      <input id="authSenha" type="password" placeholder="••••••••" autocomplete="current-password" />
    </div>

    <div class="auth-actions">
      <button class="btn-secondary" id="btnEntrar">Entrar</button>
    </div>
  </div>

  <div class="hint" id="authMsg"></div>
</section>

<!-- =========================
     TELA 2: APP
========================= -->
<div class="app-container">
<div id="postLogin" style="display:none;">

  <!-- =========================
       PAINEL / TOPO
  ========================= -->
  <section class="card">
    <div class="section-head">
      <div>
        <div class="saved-title">Painel</div>
        <div class="saved-meta" id="userBadge">—</div>
      </div>

      <div class="actions-row" style="margin:0;">
        <div class="firebase-pill" id="firebaseStatus">Firebase: não conectado</div>
        <button class="btn-danger" onclick="sair()" id="btnSair">Sair</button>
      </div>
    </div>
  </section>

  <!-- =========================
       GERAR LISTA DE EBÓ
  ========================= -->
  <section class="card">
    <h2>Gerar lista de ebó</h2>

    <label class="label">Nome do ebó</label>
    <input
      id="eboNome"
      type="text"
      placeholder="Ex: Ebó Exu"
      oninput="autoCarregarListaDebounced()"
    />

    <label class="label" style="margin-top:12px;">
      Quantidade de Pessoas
    </label>
    <input
      id="numPratos"
      type="number"
      min="1"
      placeholder="Ex: 7, 9, 11, 21"
      value="1"
    />

    <div class="actions-row">
      <button class="btn-secondary" onclick="adicionarListaAcumulada()">Adicionar lista</button>
      <button class="btn-tertiary" onclick="gerarListaFinalAcumulada()">Gerar Lista</button>
      <button class="btn-print" onclick="imprimirListaGerada()">Imprimir</button>

    </div>

    <div class="hint">
      A lista será calculada multiplicando as quantidades cadastradas pela quantidade de pratos.
    </div>
  </section>

  <!-- =========================
       LISTAS ADICIONADAS
  ========================= -->
  <section class="card">
    <div class="section-head">
      <h2 style="margin:0;">Listas adicionadas</h2>
      <div class="actions-row" style="margin:0;">
        <button class="btn-danger btn-mini" onclick="limparListasAcumuladas()">Limpar tudo</button>
      </div>
    </div>

    <div class="hint">
      Aqui aparecem as listas que você adicionou. Você pode remover individualmente.
    </div>

    <div id="listasContainer"></div>
  </section>

  <!-- =========================
       GERENCIAR LISTAS
  ========================= -->
  <section class="card">
    <div class="section-head">
      <h2>Gerenciar listas</h2>
    </div>

    <div class="actions-row">
      <button class="btn-secondary" onclick="cadastrarLista()">Cadastrar lista</button>

      <input
        id="pesquisaListas"
        type="text"
        placeholder="Procurar lista pelo nome..."
        style="max-width:320px;"
      />

      <button class="btn-tertiary" onclick="procurarListas()">Procurar</button>
    </div>

    <div id="listasSalvasBox" class="saved-list"></div>
  </section>

 <!-- =========================
     ADMIN / USUÁRIOS (PARTE DE BAIXO)
========================= -->
<div class="admin-grid-wrapper">

  <!-- Admin Master -->
  <section class="card" id="adminPanel" style="display:none;">
    <h3 style="margin:0 0 8px 0;">Admin (Master)</h3>

    <div class="admin-grid">
      <div>
        <label class="label">Novo usuário</label>
        <input id="newUser" type="text" placeholder="ex: cliente10" />
      </div>

      <div>
        <label class="label">Senha inicial</label>
        <input id="newPass" type="password" placeholder="senha inicial" />
      </div>
    </div>

    <div class="auth-actions" style="margin-top:10px;">
      <button class="btn-secondary" onclick="cadastrarMaster()">Cadastrar Master</button> </br></br>
      <button class="btn-tertiary" onclick="cadastrarCliente()">Cadastrar Cliente</button>
    </div>

    <div class="hint">
      Dica: para cadastrar outro usuário, você vai confirmar a sua senha de master (para voltar a logar depois do cadastro).
    </div>
  </section>

  <!-- Contas -->
  <section class="card">
    <h3 style="margin:0 0 8px 0;">Contas (Masters e Clientes)</h3>

    <div class="actions-row" style="margin-bottom:10px;">
      <button class="btn-secondary" onclick="listarContas()">Atualizar lista</button>
    </div>

    <div id="accountsBox" class="saved-list"></div>
  </section>

  <!-- Renomear / Trocar senha -->
  <section class="card">
    <h3 style="margin:0 0 8px 0;">Renomear login / Trocar senha</h3>

    <div class="admin-grid">
      <div>
        <label class="label">Usuário (atual)</label>
        <input id="manageUser" type="text" placeholder="ex: cliente10" />
      </div>

      <div>
        <label class="label">Novo usuário (para renomear)</label>
        <input id="manageNewUser" type="text" placeholder="ex: cliente11" />
      </div>

      <div>
        <label class="label">Nova senha</label>
        <input id="manageNewPass" type="password" placeholder="nova senha" />
      </div>
    </div>

    <div class="auth-actions" style="margin-top:10px;">
      <button class="btn-secondary" onclick="adminRenomearLogin()">Renomear login</button> </br></br>
      <button class="btn-tertiary" onclick="adminTrocarSenha()">Trocar senha</button> </br></br>
      <button class="btn-danger" onclick="adminBloquearUsuario()">Bloquear usuário</button>
    </div>

    <div class="hint" style="margin-top:8px;">
      Obs: renomear login e trocar senha exigem Cloud Function. Bloquear funciona só no Firestore.
    </div>
  </section>

</div>

  <!-- =========================
       IMPRESSÃO
  ========================= -->
  <section id="saidaPrint" class="print-area" style="display:none;">

  <div class="print-header">
    <img src="imagem.png" alt="Ilê D’Ogum" class="print-logo">
    <h1 id="printEboNome"></h1>

    <table>
      <thead>
  <tr>
    <th class="print-total">Total</th>
    <th class="print-ing">Ingrediente</th>
    <th class="print-pratos">Pratos</th>
  </tr>
</thead>
      <tbody id="printIngredientes"></tbody>
  </table>
    </section>

</div>
</div>

<!-- =========================
     MODAL
========================= -->
<div id="modalBackdrop" class="modal-backdrop" style="display:none;">
  <div class="modal-card">

    <div class="section-head">
      <h3 style="margin:0;" id="modalTitulo">Cadastrar lista</h3>
      <button class="btn-danger btn-mini" onclick="fecharModal()">X</button>
    </div>

    <!-- ====== BLOCO 1 ====== -->
    <div style="margin-top:10px; padding:12px; border:1px solid #eee; border-radius:12px;">
      <div class="saved-title" style="margin-bottom:10px;">Lista 1</div>

      <!-- Nome do ebó 1 -->
      <label class="label">Nome do ebó</label>
      <input id="modalNomeEbo_1" type="text" placeholder="Ex: Ebó Exu" />

   

      <!-- Ingredientes 1 -->
      <div class="section-head" style="margin:12px 0 8px;">
        <div class="saved-title">Ingredientes</div>
        <button class="btn-tertiary btn-mini" onclick="modalAdicionarLinha('1')">+ Adicionar linha</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Ingrediente</th>
            <th style="width:160px;">Quantidade</th>
            <th style="width:120px;">Ação</th>
          </tr>
        </thead>
        <tbody id="modalBodyLinhas_1"></tbody>
      </table>
    </div>

    <!-- ====== BLOCO 2 ====== -->
    <div style="margin-top:12px; padding:12px; border:1px solid #eee; border-radius:12px;">
      <div class="saved-title" style="margin-bottom:8px;">Modo de fazer</div>
      <textarea
        id="modalModoFazer_1"
        placeholder="Escreva aqui o modo de fazer..."
        style="width:100%; min-height:120px; padding:10px; border-radius:10px; border:1px solid #ddd; outline:none; resize:vertical;"
      ></textarea>
    </div>

    <!-- ====== BLOCO 3 ====== -->
    <div style="margin-top:12px; padding:12px; border:1px solid #eee; border-radius:12px;">
      <div class="saved-title" style="margin-bottom:10px;">Lista 2</div>

      <!-- Nome do ebó 2 -->
      <label class="label">Nome do ebó</label>
      <input id="modalNomeEbo_2" type="text" placeholder="Ex: Ebó Oxum" />

      <!-- Ingredientes 2 -->
      <div class="section-head" style="margin:12px 0 8px;">
        <div class="saved-title">Ingredientes</div>
        <button class="btn-tertiary btn-mini" onclick="modalAdicionarLinha('2')">+ Adicionar linha</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Ingrediente</th>
            <th style="width:160px;">Quantidade</th>
            <th style="width:120px;">Ação</th>
          </tr>
        </thead>
        <tbody id="modalBodyLinhas_2"></tbody>
      </table>
    </div>

    <!-- ====== BLOCO 4 ====== -->
    <div style="margin-top:12px; padding:12px; border:1px solid #eee; border-radius:12px;">
      <div class="saved-title" style="margin-bottom:8px;">Modo de preparo</div>
      <textarea
        id="modalModoFazer_2"
        placeholder="Escreva aqui o modo de preparo..."
        style="width:100%; min-height:120px; padding:10px; border-radius:10px; border:1px solid #ddd; outline:none; resize:vertical;"
      ></textarea>
    </div>

    <div class="actions-row" style="margin-top:12px;">
      <button class="btn-secondary" onclick="enviarParaBanco()">Enviar para banco de dados</button>
      <button onclick="fecharModal()">Cancelar</button>
    </div>

    <div class="hint" id="modalMsg" style="margin-top:8px;"></div>
  </div>
</div>


<!-- Firebase -->
<script type="module">
  const firebaseConfig = {
    apiKey: "AIzaSyByEkOQbZT0hN1yPG9PfM7uqKJ7JuzXoSs",
    authDomain: "ebos-oferendas.firebaseapp.com",
    projectId: "ebos-oferendas",
    storageBucket: "ebos-oferendas.firebasestorage.app",
    messagingSenderId: "534673187125",
    appId: "1:534673187125:web:55dd61b0e44eab893e2c7c"
  };

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";

  import {
    getFirestore,
    collection, addDoc, doc, getDoc, getDocs,
    setDoc, deleteDoc,
    query, orderBy, limit, startAt, endAt,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  import {
    getAuth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  window.__FIREBASE__ = {
    db,
    collection, addDoc, doc, getDoc, getDocs,
    setDoc, deleteDoc,
    query, orderBy, limit, startAt, endAt,
    serverTimestamp,

    auth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    signOut
  };
</script>

<script src="./java.js" defer></script>

</body>
</html>

